# Zen æ€§èƒ½å„ªåŒ–æœ€çµ‚å ±å‘Šï¼šå®Œæ•´ Benchmark çµæœ

## ğŸ“Š ç¶œåˆæ€§èƒ½å°æ¯” (å®Œæ•´æ•¸æ“š)

### åŸºç¤æ“ä½œæ€§èƒ½

#### Read Performance (1000x iterations)

| ç‰ˆæœ¬ | ops/s | vs Zen V1 | vs Solid |
|------|-------|-----------|----------|
| **Zen V1** | 185,016 | - | **-95.0%** (20x slower) |
| **Zen V2** | 1,077,879 | **+482%** | -70.9% (3.4x slower) |
| **Zen V3** | 1,091,965 | **+490%** | -70.5% (3.4x slower) |
| **Zen V4** â­ | 1,107,377 | **+498%** | -70.1% (3.3x slower) |
| **Solid** ğŸ† | 3,699,085 | **+1899%** | - |

#### Write Performance (1000x iterations)

| ç‰ˆæœ¬ | ops/s | vs Zen V1 | vs Solid |
|------|-------|-----------|----------|
| **Zen V1** | 180,524 | - | **-95.1%** (20.6x slower) |
| **Zen V2** | 1,107,387 | **+513%** | -70.2% (3.4x slower) |
| **Zen V3** | 710,122 | **+293%** | -80.9% (5.2x slower) |
| **Zen V4** â­ | 1,254,344 | **+595%** | **-66.2%** (3.0x slower) |
| **Solid** ğŸ† | 3,714,649 | **+1958%** | - |

**é—œéµç™¼ç¾**:
- âœ… V1 â†’ V4: Read +498%, Write +595%
- âœ… V4 èˆ‡ Solid åŸºç¤æ“ä½œå·®è·ç¸®å°åˆ° **3-3.3x**
- âœ… API æ”¹é€² (get/set â†’ bound function) å¸¶ä¾†å·¨å¤§æå‡

---

### ğŸ”¥ è¤‡é›œä¾è³´åœ–æ€§èƒ½ (é‡é»)

#### 3-Level Chain (1000x iterations)

```typescript
const a = signal(1);
const b = computed(() => a() * 2);
const c = computed(() => b() + 10);
const d = computed(() => c() / 2);
// Update a and read d
```

| ç‰ˆæœ¬ | ops/s | vs Zen V1 | vs Solid |
|------|-------|-----------|----------|
| **Zen V1** | 68,419 | - | **-93.1%** (13.4x slower) |
| **Zen V2** | 7,544 | **-89.0%** âŒ | **-99.2%** (121.7x slower) |
| **Zen V3** | 12,020 | **-82.4%** âŒ | **-98.7%** (76.4x slower) |
| **Zen V4** | 18,666 | **-72.7%** âŒ | **-98.0%** (49.2x slower) |
| **Zen V5** | 10,308 | **-84.9%** âŒ | **-98.9%** (88.6x slower) |
| **Solid** ğŸ† | 917,931 | **+1241%** | - |

**å•é¡Œ**: V2-V5 åœ¨ chain å ´æ™¯åš´é‡é€€åŒ–ï¼

#### Diamond Dependency (100x iterations)

```typescript
const a = signal(1);
const b = computed(() => a() * 2);
const c = computed(() => a() + 10);
const d = computed(() => b() + c());
// Update a and read d
```

| ç‰ˆæœ¬ | ops/s | vs Zen V1 | vs Solid |
|------|-------|-----------|----------|
| **Zen V1** ğŸ”¥ | 563,615 | - | **-90.8%** (10.8x slower) |
| **Zen V2** | 50,738 | **-91.0%** âŒ | **-99.2%** (120.4x slower) |
| **Zen V3** | 47,566 | **-91.6%** âŒ | **-99.2%** (128.4x slower) |
| **Zen V4** | 251,146 | **-55.4%** | **-95.9%** (24.3x slower) |
| **Zen V5** | 77,787 | **-86.2%** âŒ | **-98.7%** (79.2x slower) |
| **Solid** ğŸ† | 6,106,947 | **+984%** | - |

**é—œéµç™¼ç¾**:
- â­ V1 åœ¨ Diamond æœ€å¿« (547K-563K ops/s)
- âœ… V4 æ¬¡ä¹‹ (251K ops/s, -55% vs V1)
- âŒ V2/V3/V5 åš´é‡é€€åŒ– (-86% to -91% vs V1)
- ğŸ¯ èˆ‡ Solid å·®è·: **10.8x** (V1) to **128x** (V3)

#### 5-Level Deep Tree (100x iterations)

```typescript
const a = signal(1);
const b = computed(() => a() * 2);
const c = computed(() => b() + 10);
const d = computed(() => c() / 2);
const e = computed(() => d() + 5);
// Update a and read e
```

| ç‰ˆæœ¬ | ops/s | vs Zen V1 | vs Solid |
|------|-------|-----------|----------|
| **Zen V1** ğŸ”¥ | 505,013 | - | **-91.1%** (11.3x slower) |
| **Zen V2** | 62,123 | **-87.7%** âŒ | **-98.9%** (91.6x slower) |
| **Zen V3** | 99,041 | **-80.4%** âŒ | **-98.3%** (57.5x slower) |
| **Zen V4** | 118,350 | **-76.6%** âŒ | **-97.9%** (48.1x slower) |
| **Zen V5** | 68,150 | **-86.5%** âŒ | **-98.8%** (84.6x slower) |
| **Solid** ğŸ† | 5,691,815 | **+1027%** | - |

**é—œéµç™¼ç¾**:
- â­ V1 ä»ç„¶æœ€å¿« (505K ops/s)
- âŒ æ‰€æœ‰æ–°ç‰ˆæœ¬ (V2-V5) éƒ½é¡¯è‘—æ…¢æ–¼ V1
- ğŸ¯ V4 vs Solid: **48.1x** å·®è·

---

### ğŸ“ˆ V1 vs V4 vs Solid: å®Œæ•´å°æ¯”

#### æ€§èƒ½çŸ©é™£

| å ´æ™¯ | V1 | V4 | Solid | V4 vs V1 | V4 vs Solid |
|------|----|----|-------|----------|-------------|
| **Read (1000x)** | 185K | **1.11M** âœ… | 3.70M | **+498%** | -70% (3.3x) |
| **Write (1000x)** | 181K | **1.25M** âœ… | 3.71M | **+595%** | -66% (3.0x) |
| **3-Level Chain** | **68K** âœ… | 19K | 918K | **-73%** âŒ | -98% (49x) |
| **Diamond** | **564K** âœ… | 251K | 6.11M | **-55%** âŒ | -96% (24x) |
| **5-Level Tree** | **505K** âœ… | 118K | 5.69M | **-77%** âŒ | -98% (48x) |

**çµè«–**:
1. **åŸºç¤æ“ä½œ**: V4 å®Œå‹ V1 (+498-595%)
2. **è¤‡é›œä¾è³´åœ–**: V1 å®Œå‹ V4 (+55-77%)
3. **èˆ‡ Solid å°æ¯”**:
   - åŸºç¤æ“ä½œ: 3-3.3x å·®è· (å¯æ¥å—)
   - è¤‡é›œåœ–: 24-49x å·®è· (å·¨å¤§)

---

### ğŸ”¬ V4 vs V5 vs V6 vs V7b: æ¼¸é€²å„ªåŒ–

#### Diamond Performance Progression

| ç‰ˆæœ¬ | ops/s | vs V4 | å„ªåŒ–ç­–ç•¥ | çµæœ |
|------|-------|-------|----------|------|
| V4 â­ | 224,000 | - | Timestamp + æ°¸ä¹…ä¾è³´ | âœ… åŸºæº– |
| V5 | 80,000 | **-64%** âŒ | Graph + Inline + Cleanup | âŒ å¤±æ•— |
| V6 | 220,000 | -2% | V4 + Selective inline | âš ï¸ æŒå¹³ |
| V7a | 232,000 | +4% | Remove dup check + Set | âŒ å¾®æå‡ |
| V7b â­â­ | 238,000 | **+6%** âœ… | Monomorphic + Minimal fields | âœ… æˆåŠŸ |

**æœ€çµ‚çµè«–**: V4 â†’ V7b åƒ… +6%ï¼Œæ”¶ç›Šéæ¸›

---

## ğŸ’¡ é—œéµæ´å¯Ÿ

### 1. API è¨­è¨ˆçš„å·¨å¤§å½±éŸ¿

```typescript
// V1 (æ‰‹å‹• API)
const count = zen(0);
set(count, get(count) + 1);  // 185K reads/s, 181K writes/s

// V4 (Bound Function API)
const count = signal(0);
count.set(count() + 1);  // 1.11M reads/s, 1.25M writes/s

// æå‡: +498-595%
```

**åŸå› **: å‡½æ•¸èª¿ç”¨é–‹éŠ· + åƒæ•¸å‚³éæ¶ˆé™¤

### 2. æ°¸ä¹…ä¾è³´ vs å‹•æ…‹ä¾è³´çš„æ¬Šè¡¡

| ç­–ç•¥ | åŸºç¤æ“ä½œ | è¤‡é›œåœ– | å‹•æ…‹ä¾è³´ | ä»£ç¢¼è¤‡é›œåº¦ |
|------|---------|--------|----------|-----------|
| **V1 (å‹•æ…‹)** | æ…¢ | **å¿«** âœ… | âœ… æ”¯æŒ | ä¸­ |
| **V4 (æ°¸ä¹…)** | **å¿«** âœ… | æ…¢ | âŒ ä¸æ”¯æŒ | ä½ |
| **Solid (å‹•æ…‹)** | **å¿«** âœ… | **å¿«** âœ… | âœ… æ”¯æŒ | é«˜ |

**çµè«–**:
- Solid çš„æ€§èƒ½ä¾†è‡ªæ–¼æ¯æ¬¡ cleanup + re-trackï¼Œä½†ä¿æŒäº†é«˜æ€§èƒ½
- Zen çš„æ°¸ä¹…ä¾è³´é™åˆ¶äº†è¤‡é›œåœ–æ€§èƒ½

### 3. èˆ‡ Solid çš„å·®è·åˆ†æ

#### åŸºç¤æ“ä½œ (3-3.3x)

**å¯è§£é‡‹çš„å·®è·**:
- âœ… Bidirectional slots (Zen: O(n), Solid: O(1))
- âœ… å…§è¯ä¾è³´è¿½è¹¤ (Zen: å‡½æ•¸èª¿ç”¨ï¼ŒSolid: å…§è¯)
- âœ… åˆ†é›¢ Updates/Effects éšŠåˆ—
- âœ… æ›´æ¿€é€²çš„ V8 å„ªåŒ–

**å¯ç§»æ¤å„ªåŒ–**: V8 é æœŸ +50-83%ï¼Œç¸®å°åˆ° **~2x** å·®è·

#### è¤‡é›œåœ– (24-49x)

**æ ¹æœ¬æ€§å·®è·**:
- âŒ ä¸‰ç‹€æ…‹ç®¡ç† (CLEAN/STALE/PENDING) vs Timestamp
- âŒ Push-Pull æ··åˆ vs Pure Pull
- âŒ æ™ºèƒ½å‚³æ’­ (markDownstream) vs æš´åŠ›æª¢æŸ¥
- âŒ Lazy evaluation vs Eager checking

**ç„¡æ³•ç§»æ¤**: éœ€è¦å‹•æ…‹ä¾è³´é…åˆï¼Œèˆ‡ Zen çš„æ°¸ä¹…ä¾è³´ä¸å…¼å®¹

---

## ğŸ¯ æœ€çµ‚æ¨è–¦

### ç”Ÿç”¢ä½¿ç”¨

| å ´æ™¯ | æ¨è–¦ç‰ˆæœ¬ | åŸå›  | æ€§èƒ½ |
|------|---------|------|------|
| **æ–°é …ç›®ï¼ˆé€šç”¨ï¼‰** | **V4** â­ | æœ€ç°¡å–®ï¼ŒåŸºç¤æ“ä½œæœ€å¿« | Read: 1.11M, Write: 1.25M |
| **å¯«å¯†é›†æ‡‰ç”¨** | **V4** â­ | å¯«å…¥æ€§èƒ½æœ€ä½³ | Write: 1.25M ops/s |
| **è®€å¯†é›† + è¤‡é›œåœ–** | **V7b** â­â­ | è¤‡é›œåœ–æœ€å„ª | Diamond: 238K (+6% vs V4) |
| **æ¥µç«¯è¤‡é›œåœ–** | **V1** | Diamond æœ€å¿« | Diamond: 564K (ä½† API å·®) |
| **æ¥µç«¯æ€§èƒ½éœ€æ±‚** | **SolidJS** ğŸ† | å…¨æ–¹ä½æœ€å¿« | Diamond: 6.11M (24x faster) |

### æ€§èƒ½è©•ç´š

```
åŸºç¤æ“ä½œ:
V1 (180K)  â”â”â”â”â”â”â”â”“
                  â”—â”â”> V4 (1.2M) â¬†ï¸ 6x  â”“
                                         â”—â”â”> Solid (3.7M) â¬†ï¸ 3x

è¤‡é›œåœ– (Diamond):
Solid (6.1M) â”â”â”â”â”â”â”â”“
                    â”—â”â”> V1 (564K) â¬‡ï¸ 11x  â”“
                                            â”—â”â”> V4 (251K) â¬‡ï¸ 2.2x  â”“
                                                                     â”—â”â”> V7b (238K) â¬‡ï¸ 1.05x
```

---

## ğŸ“Š å®Œæ•´ Benchmark æ•¸æ“šè¡¨

### Four-Way Comparison (V1, V2, V3, Solid)

| Benchmark | V1 | V2 | V3 | Solid | æœ€ä½³ |
|-----------|----|----|----|----|-----|
| Read (1000x) | 189,608 | 1,106,978 | 1,109,740 | 3,715,551 | Solid |
| Write (1000x) | 180,044 | 3,137,738 | 3,121,737 | 3,709,377 | Solid |
| Computed Read (1000x) | 191,152 | 978,382 | 863,944 | 3,745,901 | Solid |
| Update Source (100x) | 289,665 | 243,159 | 151,713 | 7,241,277 | Solid |
| 3-Level Chain (1000x) | **68,267** âœ… | 7,904 | 11,866 | 930,040 | Solid |
| Diamond | **554,484** âœ… | 51,186 | 47,508 | 6,003,459 | Solid |
| 5-Level Tree | **493,590** âœ… | 58,372 | 93,022 | 5,795,167 | Solid |
| Batch (100x) | 497,734 | 836,741 | 809,055 | 9,125,934 | Solid |
| 10 Sources | 389,847 | 71,321 | 34,126 | 1,612,597 | Solid |

### Final Comparison (V1, V2, V3, V4, Solid)

| Benchmark | V1 | V2 | V3 | V4 | Solid | æœ€ä½³ |
|-----------|----|----|----|----|-------|-----|
| Read (1000x) | 185,016 | 1,077,879 | 1,091,965 | 1,107,377 | 3,699,085 | Solid |
| Write (1000x) | 180,524 | 1,107,387 | 710,122 | **1,254,344** â­ | 3,714,649 | Solid |
| Computed Read (1000x) | 185,696 | 788,164 | 779,641 | 244,558 | 3,763,370 | Solid |
| 3-Level Chain (1000x) | **68,419** âœ… | 7,544 | 12,020 | 18,666 | 917,931 | Solid |
| Diamond (100x) | **563,615** âœ… | 50,738 | 47,566 | 251,146 | 6,106,947 | Solid |
| 5-Level Tree (100x) | **505,013** âœ… | 62,123 | 99,041 | 118,350 | 5,691,815 | Solid |

### Ultimate Benchmark (V1, V4, V5, Solid)

| Benchmark | V1 | V4 | V5 | Solid | æœ€ä½³ |
|-----------|----|----|----|----|-----|
| Read (1000x) | 182,125 | **1,118,380** â­ | 1,104,435 | 3,766,624 | Solid |
| Write (1000x) | 185,671 | **1,272,148** â­ | 645,954 | 3,717,197 | Solid |
| 3-Level Chain (1000x) | **74,898** âœ… | 18,667 | 10,308 | 912,766 | Solid |
| Diamond (100x) | **573,246** âœ… | 250,453 | 77,787 | 6,161,685 | Solid |
| 5-Level Tree (100x) | **585,083** âœ… | 122,031 | 68,150 | 5,761,779 | Solid |

---

## ğŸ”¥ æ€§èƒ½ç†±é»åˆ†æ

### ç‚ºä»€éº¼ V2/V3 åœ¨è¤‡é›œåœ–å¦‚æ­¤æ…¢ï¼Ÿ

**V2 (Push-based)**:
```typescript
// æ¯æ¬¡ signal æ”¹è®Šï¼Œç«‹å³æ›´æ–°æ‰€æœ‰ computed
setter(newValue) {
  node.value = newValue;
  if (node.observers && batchDepth === 0) {
    for (const o of node.observers) {
      updateComputed(o);  // âŒ å¼·åˆ¶è¨ˆç®—ï¼ˆå³ä½¿æ²’äººè®€å–ï¼‰
    }
  }
}
```

**å•é¡Œ**: Diamond å ´æ™¯ï¼Œd æœƒè¢«è¨ˆç®— 2 æ¬¡ï¼ˆb æ”¹è®Š 1 æ¬¡ï¼Œc æ”¹è®Š 1 æ¬¡ï¼‰

**V4 (Pull-based)**:
```typescript
// Signal æ”¹è®Šåªæ›´æ–° timestamp
setter(newValue) {
  node.value = newValue;
  node.updatedAt = ++ExecCount;  // âœ… åªæ¨™è¨˜
}

// Computed åœ¨è®€å–æ™‚æª¢æŸ¥
getter() {
  if (needsUpdate(node)) {
    update(node);  // âœ… æŒ‰éœ€è¨ˆç®—
  }
  return node.value;
}
```

**æ”¹é€²**: Diamond å ´æ™¯ï¼Œd åªè¨ˆç®— 1 æ¬¡

### ç‚ºä»€éº¼ V1 åœ¨è¤‡é›œåœ–æœ€å¿«ï¼Ÿ

**V1 (Graph Coloring)**:
```typescript
// ä¸‰ç‹€æ…‹: CLEAN (0), GREEN (1), RED (2)

// Signal æ”¹è®Šï¼Œæ¨™è¨˜è§€å¯Ÿè€…ç‚º GREEN
setter(newValue) {
  node.value = newValue;
  for (const o of node.observers) {
    o.color = GREEN;  // âœ… åªæ¨™è¨˜ï¼Œä¸è¨ˆç®—
  }
}

// Computed è®€å–æ™‚æª¢æŸ¥
getter() {
  if (node.color === GREEN) {
    if (checkSourcesClean(node)) {
      node.color = CLEAN;  // âœ… Sources æ²’è®Šï¼Œç›´æ¥è¿”å›
      return node.value;
    }
  }
  // ... éœ€è¦æ›´æ–°æ‰è¨ˆç®—
}
```

**å„ªå‹¢**:
- GREEN ç‹€æ…‹å…è¨±å»¶é²æª¢æŸ¥
- checkSourcesClean éæ­¸æª¢æŸ¥æ˜¯å¦çœŸçš„éœ€è¦æ›´æ–°
- Diamond å ´æ™¯é¿å…é‡è¤‡è¨ˆç®—

**ä»£åƒ¹**:
- æ¯æ¬¡æ›´æ–°éƒ½è¦ cleanup + re-track
- API ç¬¨æ‹™ (get/set)

---

## ğŸ“ˆ å„ªåŒ–è·¯ç·šåœ–

### å·²å®Œæˆ

1. âœ… **V1**: Graph coloring (è¤‡é›œåœ–æœ€å¿«)
2. âœ… **V2**: Bound function API (åŸºç¤æ“ä½œ +5x)
3. âœ… **V3**: Pull-based (ä¿®å¾© V2)
4. âœ… **V4**: Timestamp + æ°¸ä¹…ä¾è³´ (æœ€å¹³è¡¡) â­
5. âœ… **V5**: éåº¦å„ªåŒ– (å¤±æ•—)
6. âœ… **V6**: Selective inline (å¾®æ”¹é€²)
7. âœ… **V7a**: Set dedup (å¤±æ•—)
8. âœ… **V7b**: Monomorphic (è¤‡é›œåœ– +6%) â­â­
9. âœ… **V7c**: Graph + æ°¸ä¹…ä¾è³´ (æ ¹æœ¬ä¸å…¼å®¹)
10. âœ… **SolidJS æºç¢¼åˆ†æ**: å®Œæ•´è§£è®€ 1809 è¡Œ

### æ½›åœ¨ V8

**ç›®æ¨™**: +50-83% (Diamond: 350-400K)

**ç­–ç•¥**:
1. âœ… Bidirectional Slots (+30-50%)
2. âœ… å…§è¯ä¾è³´è¿½è¹¤ (+5-10%)
3. âœ… åˆ†é›¢ Updates/Effects (+10-15%)
4. âœ… å„ªåŒ– ExecCount (+5-8%)

**é æœŸçµæœ**:
- Diamond: 350-400K (vs Solid: ä»æœ‰ **15-17x** å·®è·)
- ä»£ç¢¼è¤‡é›œåº¦é¡¯è‘—å¢åŠ 

### é•·æœŸæ–¹å‘

1. **ç·¨è­¯å™¨** (like Solid's babel-preset-solid)
   - æ§‹å»ºæ™‚åˆ†æä¾è³´åœ–
   - å…§è¯æ‰€æœ‰ signal è¨ªå•
   - ç”Ÿæˆå„ªåŒ–ä»£ç¢¼

2. **æ··åˆç­–ç•¥**
   - ç°¡å–®åœ–: V4 (æ°¸ä¹…ä¾è³´)
   - è¤‡é›œåœ–: V1 (å‹•æ…‹ä¾è³´)

3. **æ¥å—ç¾å¯¦**
   - V4/V7b å·²ç¶“éå¸¸å¥½
   - æ¥µç«¯æ€§èƒ½ç”¨ SolidJS

---

## ğŸ“ ç¸½çµ

### æˆå°±

1. **9 å€‹ç‰ˆæœ¬è¿­ä»£** (33% æˆåŠŸç‡)
2. **æ€§èƒ½æå‡**: V1 â†’ V4 åŸºç¤æ“ä½œ +498-595%
3. **æ·±åº¦åˆ†æ**: SolidJS 1809 è¡Œæ ¸å¿ƒæºç¢¼å®Œæ•´è§£è®€
4. **å®Œæ•´æ–‡æª”**: 12 å€‹æ ¸å¿ƒæ–‡æª”ï¼Œ7,327+ è¡Œ
5. **æ¸…æ™°èªçŸ¥**: é‹è¡Œæ™‚å„ªåŒ–æ¥µé™ï¼ŒV4/V7b å·²æ˜¯æœ€ä½³

### é—œéµå­¸ç¿’

1. **API è¨­è¨ˆæ¥µå…¶é‡è¦**: +498-595% æå‡
2. **æ°¸ä¹…ä¾è³´æœ‰å„ªå‹¢**: æ›´æ–°å¿«ï¼Œä»£ç¢¼ç°¡å–®
3. **ä½†æœ‰å±€é™**: è¤‡é›œåœ–æ€§èƒ½å—é™
4. **Solid çš„ç§˜å¯†**: Bidirectional Slots + ä¸‰ç‹€æ…‹ + å…§è¯
5. **æ ¹æœ¬å·®ç•°**: å‹•æ…‹ä¾è³´ vs æ°¸ä¹…ä¾è³´

### æœ€çµ‚å»ºè­°

**90% å ´æ™¯**: ä½¿ç”¨ **V4** â­
- æœ€ç°¡å–®
- æœ€å¹³è¡¡
- åŸºç¤æ“ä½œæœ€å¿«

**10% å ´æ™¯** (è¤‡é›œåœ–): ä½¿ç”¨ **V7b** â­â­ æˆ– **V1**
- V7b: +6% vs V4ï¼Œç¾ä»£ API
- V1: +124% vs V4 (Diamond)ï¼Œä½† API å·®

**æ¥µç«¯æ€§èƒ½**: ä½¿ç”¨ **SolidJS** ğŸ†
- å…¨æ–¹ä½æœ€å¿«
- 24-49x å„ªå‹¢ (è¤‡é›œåœ–)

---

**ç‹€æ…‹**: âœ… å„ªåŒ–å®Œæˆï¼Œåˆ†æå®Œæˆ
**æ¨è–¦**: V4 (é€šç”¨) æˆ– V7b (è¤‡é›œåœ–)
**ä¸‹ä¸€æ­¥**: ä½¿ç”¨æˆ–ç ”ç©¶ç·¨è­¯å™¨æ–¹æ¡ˆ

ğŸš€ **Happy coding!**
